# UDP接收问题排查指南

## 当前状态
- ✅ UDP服务器已启动，监听在 `0.0.0.0:3333`
- ✅ 本机IP地址: `192.168.3.40` (WLAN 2) 或 `192.168.3.41` (以太网)
- ⚠️ 防火墙规则可能需要管理员权限添加

## 排查步骤

### 1. 检查防火墙（需要管理员权限）

以管理员身份运行PowerShell，执行：
```powershell
New-NetFirewallRule -DisplayName "TUIO UDP 3333" -Direction Inbound -Protocol UDP -LocalPort 3333 -Action Allow
```

或者手动添加：
1. 打开"Windows Defender 防火墙"
2. 点击"高级设置"
3. 选择"入站规则" → "新建规则"
4. 选择"端口" → "UDP" → "特定本地端口: 3333"
5. 选择"允许连接"
6. 应用到所有配置文件
7. 命名为"TUIO UDP 3333"

### 2. 验证UDP接收

使用测试工具验证UDP是否正常工作：

```bash
# 停止主服务器，运行测试工具
node test-udp-receive.js
```

然后在手机上发送测试消息，如果测试工具能收到，说明UDP接收正常。

### 3. 检查手机TUIOpad配置

确保手机TUIOpad配置正确：
- **Host**: `192.168.3.40` 或 `192.168.3.41`（不是127.0.0.1）
- **Port**: `3333`
- **Protocol**: `UDP`

### 4. 检查网络连接

确保手机和PC在同一WiFi网络：
- 手机WiFi IP应该类似 `192.168.3.x`
- PC IP是 `192.168.3.40` 或 `192.168.3.41`
- 两者应该在同一个子网

### 5. 查看服务器日志

重启服务器后，查看控制台输出：
- 应该看到：`[TUIO Bridge] ✓ UDP 服务器已启动`
- 应该看到：`提示: 请在手机TUIOpad中配置以下IP地址之一`
- 发送消息时应该看到：`[UDP Server] ===== 收到UDP消息 =====`

### 6. 如果仍然收不到消息

尝试以下方法：

1. **使用测试工具**：
   ```bash
   node test-udp-receive.js
   ```
   如果测试工具也收不到，说明是网络或防火墙问题。

2. **临时关闭防火墙测试**（仅用于测试）：
   - 控制面板 → Windows Defender 防火墙 → 关闭防火墙（临时）
   - 测试是否能收到消息
   - 测试完成后重新开启防火墙并添加规则

3. **检查路由器设置**：
   - 某些路由器可能阻止设备间通信
   - 检查是否有"AP隔离"或"客户端隔离"设置

4. **使用网络抓包工具**：
   - 使用Wireshark监听UDP 3333端口
   - 查看是否有数据包到达

## 测试命令

```bash
# 1. 测试UDP接收（独立测试）
node test-udp-receive.js

# 2. 重启主服务器
pnpm start
```

